<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles.css">

      <!-- Graficas -->
      <script src="./plotly-latest.min.js"></script>

    <title>Proyecto Equipo 1</title>
  </head>
  <body>
    <!--- Nav Bar --->
    <nav class="navbar navbar-dark bg-primary navbar-expand-lg col-12">
      <a class="navbar-brand" href="../index.html">
        <img src="../IMG/logo-tec-W.png" height="40" alt="">
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
         
          <li class="nav-item active" id="nav-payback">
            <a class="nav-link" href="Payback.html">Payback Period</a>
          </li>
          
          <li class="nav-item" id="nav-npv">
            <a class="nav-link" href="NPV.html">NPV<span class="sr-only">(current)</span></a>
          </li>
          
          <li class="nav-item" id="nav-checklist">
            <a class="nav-link" href="Checklist.html">Checklist</a>
          </li>
          
          <li class="nav-item" id="nav-depreciation">
            <a class="nav-link" href="Depreciation.html">Depreciation</a>
          </li>
          
          <li class="nav-item" id="nav-proyect">
            <a class="nav-link" href="ProyectScreening.html">Proyect Screening Methods</a>
          </li>
        </ul>
        <h4 style="color: white;">Proyecto Final / Equipo #1</h4>
      </div>
    </nav>
    
    <!--- Hovered Section --->
    
    <!--- Proyect Info --->
    <div class="banner banner-info container-fluid">
        <h2>Evaluación y Administración de Proyectos</h2>
        <h4>Proyect Portfolio Evaluation Tool</h4>
        <h4>Mtro. Octavio Gutiérrez</h4>
        <h4>Equipo 1</h4>
    </div>
    
    <!--- Payback Period Info --->
    <div class="banner banner-payback container-fluid">
        <h2>Payback Period</h2>
        <h5>El Payback Period o Periodo de retorno
            es un criterio para evaluar inversiones
            que se define como el periodo de tiempo
            requerido para recuperar el capital inicial
            de una inversión.</h5>
    </div>
    
    <!--- NPV Info --->
    <div class="banner banner-npv container-fluid">
        <h2>Net Present Value</h2>
        <h5>El Valor Presente Neto (NPV) es la diferencia entre el valor presente del cashflow y el valor presente de los cashflows de un proyecto a través del tiempo.
        Se utiliza para planificar inversiones analizando la viabilidad del un proyecto basandose en los flujos de efectivo esperados de este mismo.</h5>
    </div>
    
    <!--- Checklist Info --->
    <div class="banner banner-checklist container-fluid">
        <h2>Checklist</h2>
        <h5>Descripción del Checklist</h5>
    </div>
    
    <!--- Depreciation Info --->
    <div class="banner banner-depreciation container-fluid">
        <h2>Depreciation</h2>
        <h5>La Depreciación es un descuento concedido para el consumo de capital. Actúa como un escudo contra los impuestos.</h5>
    </div>
    
    <!--- Proyect Screening Methods --->
    <div class="banner banner-proyect container-fluid">
        <h2>Proyect Screening Methods</h2>
        <h5>Descripción de Proyect Screening Methods</h5>
    </div>

    <!--- BLOCK --->
    <div class="block container-fluid">
        <h1 class="block-title">DISCOUNTED PAYBACK PERIOD CALCULATOR</h1>
        <form>
            <div class="row">
                <div class="form-group col-6">
                    <label>Period Numbers</label>
                    <input type="number" class="form-control" id="periods-input" placeholder="1-10" required min=1 max=10>
                    <small class="form-text text-muted">Introduce un número de periodos a evaluar entre 1 - 10</small>
                </div>
                <div class="form-group col-6">
                    <label>Principal</label>
                    <input type="number" class="form-control" id="principal" placeholder="0" required min=1>
                    <small class="form-text text-muted">Introduce la cantidad inicial del proyecto</small>
                </div>
                <div class="form-group col-6">
                    <label>Discount Rate</label>
                    <input type="number" class="form-control" id="rate-input" placeholder="0.01 - 0.99" required min=1 max=99 step="0.01">
                    <small class="form-text text-muted">Introduce taza entre 1% - 99% (2 decimales y si es 0 se calculara solo el payback period)</small>
                </div>
            </div>
            <div type="submit" class="btn btn-primary" id="generar">Generar Tabla</div>
        </form>

        <div class="container" id="output">

        </div>

        <div class="row">
            <div class="col-4"></div>
            <div type="submit" class="btn btn-primary col-4" id="calcular" style="display: none;">Calcular DPBP</div>
            <div class="col-4"></div>
        </div>

        <div class="row">
            <div class="col-4"></div>
            <div type="submit" class="btn btn-primary col-4" id="calcularB" style="display: none;">Calcular PBP</div>
            <div class="col-4"></div>
        </div>

        <div class="row" style="padding-top: 20px;">
            <br>
            <div id="tester" style="width:600px;height:250px;"></div>
            <br>
            <h3 id="resultado-title" style="text-align: center; display: none; margin: auto;">Año de retorno de la inversión:</h3>
            <br>
            <h1 id="resultado" style="text-align: center; margin: auto;"></h1>
        </div>

        <div class="row">
            <div class="col-4"></div>
            <div type="submit" class="btn btn-primary col-4" id="again" style="display: none;"><a href="Payback.html" style="color: white;">Calcular otra vez</a></div>
            <div class="col-4"></div>
        </div>

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script>

        var x = [];
        var y =[];
        function graph(){
            var Netcash = {
                x,
                y,
                type: 'scatter',
            };
            var data = [Netcash];
            var layout = {
                title: 'Net Cash Flow',
                xaxis: {
                    title: 'Periodos',
                    showgrid: false,
                    zeroline: false
                },
                yaxis: {
                    title: 'Cash Flow',
                    showline: false
                }
            };
            Plotly.newPlot('tester', data, layout, {showSendToCloud: true});
        }

        var sem = 0;
        function DPBP(number, rate) {
            var periodos = $('#periods-input').val();
            var tasa = $('#rate-input').val()/100;
            var principal = $('#principal').val();
            var cash;
            var df;
            var dfc;
            x.push(number);
            if(number === 0) {
                $('#df' + number).html(1);
                df = (1 / Math.pow(1 + (rate), number));
                cash = $('#inflows' + number).val() - $('#outflows' + number).val();
                y.push(cash);
                dfc = df * cash;
                $('#dfc' + number).html((dfc).toFixed(2));
                $('#payback' + number).html((dfc).toFixed(2));
                pbp = dfc;

            } else {
                console.log("Entro en el else");
                df = (1 / Math.pow(1 + (rate), number));
                $('#df' + number).html((df).toFixed(2));
                cash = $('#inflows' + number).val() - $('#outflows' + number).val();
                dfc = df * cash;
                y.push(cash);
                $('#dfc' + number).html((dfc).toFixed(2));
                pbp = pbp + dfc;
                if(pbp >=0){
                    $('#payback' + number).html((pbp).toFixed(2).fontcolor("green"));
                    if(sem === 0){
                        $("#resultado-title").css("display", "block");
                        console.log("Calculos");
                        console.log(pbp);
                        console.log(dfc);
                        sem = (periodos-1) + ((pbp));
                        $('#resultado').html((number).toFixed(2));
                    sem = 1;}
                }
                else $('#payback' + number).html((pbp).toFixed(2));
            }
            graph();
            $("#again").css("display", "block");
        }

        function PBP(number) {
            var periodos = $('#periods-input').val();
            var principal = $('#principal').val();
            var cash;
            x.push(number);
            if(number === 0) {
                cash = $('#inflows' + number).val() - $('#outflows' + number).val();
                pbp = cash;
                y.push(cash);
                $('#payback' + number).html((pbp).toFixed(2));
            } else {
                cash = $('#inflows' + number).val() - $('#outflows' + number).val();
                pbp = pbp + cash;
                y.push(cash);
                if(pbp >=0){
                    $('#payback' + number).html((pbp).toFixed(2).fontcolor("green"));
                    if(sem === 0){
                        $("#resultado-title").css("display", "block");
                        sem = (periodos-1) + (pbp);
                        $('#resultado').html((number).toFixed(2));
                        sem = 1;}
                }
                else $('#payback' + number).html((pbp).toFixed(2));
            }
            graph();
            $("#again").css("display", "block");
        }

        function addRow(number) {
            $("#output").append('<div class="row">' +
                '<div class="col-2">' +
                '<h3>' + number + '<h3>' +
                '</div>' +
                '<div class="col-2">' +
                '<input id="inflows' + number +'" type="number" required step="0.01">' +
                '</div>' +
                '<div class="col-2">' +
                '<input id="outflows' + number +'" type="number" required step="0.01">' +
                '</div>' +
                '<div class="col-2">' +
                '<h3 id="df' + number + '"><i> - </i></h3>' +
                '</div>' +
                '<div class="col-2">' +
                '<h3 id="dfc' + number + '"><i> - </i></h3>' +
                '</div>' +
                '<div class="col-2">' +
                '<h3 id="payback' + number + '"><i> - </i></h3>' +
                '</div>'
                        );
        };

        function addRowB(number) {
            $("#output").append('<div class="row">' +
                '<div class="col-3">' +
                '<h3>' + number + '<h3>' +
                '</div>' +
                '<div class="col-3">' +
                '<input id="inflows' + number +'" type="number" required step="0.01">' +
                '</div>' +
                '<div class="col-3">' +
                '<input id="outflows' + number +'" type="number" required step="0.01">' +
                '</div>' +
                '<div class="col-3">' +
                '<h3 id="payback' + number + '"><i> - </i></h3>' +
                '</div>'
            );
        };


        $(document).ready(function() {
            $("#generar").click(function() {
                $("#output").html("<h1></h1>");

                var periodos = $('#periods-input').val();
                var tasa = $('#rate-input').val() / 100;
                var principal = $('#principal').val();
                if ((periodos >= 1) && (periodos <= 10) && (tasa > 0) && (tasa < 100)) {
                    console.log(periodos);
                    console.log(tasa);
                    console.log(principal);

                    $("#output").append("<h4> Número de periodos: " + periodos + "</h4>" + "<h4>Discount Rate: " + (tasa) + "</h4>");

                    $("#output").append(
                        '<div class="row">' +
                        '<div class="col-2">' +
                        '<h3>Period<h3>' +
                        '</div>' +
                        '<div class="col-2">' +
                        '<h3>INFLOWS<h3>' +
                        '</div>' +
                        '<div class="col-2">' +
                        '<h3>OUTFLOWS<h3>' +
                        '</div>' +
                        '<div class="col-2">' +
                        '<h3>DF<h3>' +
                        '</div>' +
                        '<div class="col-2">' +
                        '<h3>DFC<h3>' +
                        '</div>' +
                        '<div class="col-2">' +
                        '<h3>PAYBACK<h3>' +
                        '</div>' +
                        '</div>');

                    for(var i = 0; i <= periodos; i++) {
                        addRow(i);
                    }

                    $("#calcular").css("display", "block");
                    document.getElementById("outflows0").value = principal;

                } else{
                    if(tasa > 100) alert("La tasa no puede ser mayor a 100");
                    else {
                        if(tasa === " " || tasa <0) alert("Tasa  vacia favor de rellenar el campo");
                        else{
                            if(periodos < 1 || periodos > 10) alert("Los periodos deben ser entre 1 y 10");
                            else{
                                if(principal === " " || principal <= 0) alert("El campo de principal esta vacio o tiene como valor '0'");
                                else{
                                    if(tasa === 0) {
                                        $("#output").append("<h4> Número de periodos: " + periodos + "</h4>");
                                        $("#output").append(
                                            '<div class="row">' +
                                            '<div class="col-3">' +
                                            '<h3>Period<h3>' +
                                            '</div>' +
                                            '<div class="col-3">' +
                                            '<h3>INFLOWS<h3>' +
                                            '</div>' +
                                            '<div class="col-3">' +
                                            '<h3>OUTFLOWS<h3>' +
                                            '</div>' +
                                            '<div class="col-3">' +
                                            '<h3>PAYBACK<h3>' +
                                            '</div>' +
                                            '</div>');
                                        for(var x = 0; x <= periodos; x++) {
                                            addRowB(x);
                                        }

                                        $("#calcularB").css("display", "block");
                                        document.getElementById("outflows0").value = principal;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        });

        $(document).ready(function() {
            $("#calcular").click(function() {
                var periodos = $('#periods-input').val();
                var tasa = $('#rate-input').val()/100;
                var principal = $('#principal').val();
                var pbp;

                for(var i = 0; i <= periodos; i++) {
                    DPBP(i, tasa);
                }

            });

            $("#calcularB").click(function() {
                var periodos = $('#periods-input').val();
                var tasa = $('#rate-input').val()/100;
                var principal = $('#principal').val();
                var pbp;

                for(var i = 0; i <= periodos; i++) {
                    PBP(i);
                }

            });
        });
    </script>

    <script>
        $(document).ready(function(){
            $(".navbar-brand").hover(function(){
                $(".banner-info").css("display", "block");
            }, function(){
                $(".banner-info").css("display", "none");
            });
        });

        $(document).ready(function(){
            $("#nav-payback").hover(function(){
                $(".banner-payback").css("display", "block");
            }, function(){
                $(".banner-payback").css("display", "none");
            });
        });


        $(document).ready(function(){
            $("#nav-npv").hover(function(){
                $(".banner-npv").css("display", "block");
            }, function(){
                $(".banner-npv").css("display", "none");
            });
        });

        $(document).ready(function(){
            $("#nav-checklist").hover(function(){
                $(".banner-checklist").css("display", "block");
            }, function(){
                $(".banner-checklist").css("display", "none");
            });
        });

        $(document).ready(function(){
            $("#nav-depreciation").hover(function(){
                $(".banner-depreciation").css("display", "block");
            }, function(){
                $(".banner-depreciation").css("display", "none");
            });
        });

        $(document).ready(function(){
            $("#nav-proyect").hover(function(){
                $(".banner-proyect").css("display", "block");
            }, function(){
                $(".banner-proyect").css("display", "none");
            });
        });

    </script>
  </body>
</html>
